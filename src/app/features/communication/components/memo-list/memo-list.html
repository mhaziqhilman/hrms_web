<div class="max-w-7xl mx-auto p-6">
  <!-- Page Header -->
  <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
    <div>
      <h2 class="text-3xl font-semibold text-foreground flex items-center gap-2">
        <z-icon zType="megaphone" class="w-8 h-8 text-primary" />
        Memos & Announcements
      </h2>
      <p class="text-muted-foreground mt-1">View and manage company memos and announcements</p>
    </div>
    <div class="flex gap-3">
      <button
        type="button"
        z-button
        zType="outline"
        (click)="refreshMemos()"
        [disabled]="loading()"
        class="flex items-center gap-2"
      >
        <z-icon zType="refresh-cw" class="w-4 h-4" />
        Refresh
      </button>
      <a
        routerLink="/communication/memos/new"
        z-button
        zType="default"
        class="flex items-center gap-2"
      >
        <z-icon zType="plus-circle" class="w-4 h-4" />
        New Memo
      </a>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="flex items-center gap-3 mb-6 flex-wrap">
    <!-- Search -->
    <div class="relative flex-1 min-w-[300px]">
      <z-icon zType="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
      <input
        z-input
        type="text"
        class="w-full pl-10"
        placeholder="Search by title or summary..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange()"
      />
    </div>

    <!-- Status Filter -->
    <z-select
      [(ngModel)]="selectedStatus"
      (ngModelChange)="onFilterChange()"
      placeholder="All Statuses"
      class="w-[160px]"
    >
      <z-select-item zValue="">All Statuses</z-select-item>
      <z-select-item zValue="Published">Published</z-select-item>
      <z-select-item zValue="Draft">Draft</z-select-item>
      <z-select-item zValue="Archived">Archived</z-select-item>
    </z-select>

    <!-- Priority Filter -->
    <z-select
      [(ngModel)]="selectedPriority"
      (ngModelChange)="onFilterChange()"
      placeholder="All Priorities"
      class="w-[160px]"
    >
      <z-select-item zValue="">All Priorities</z-select-item>
      <z-select-item zValue="Urgent">Urgent</z-select-item>
      <z-select-item zValue="High">High</z-select-item>
      <z-select-item zValue="Normal">Normal</z-select-item>
      <z-select-item zValue="Low">Low</z-select-item>
    </z-select>

    <!-- Clear Filters -->
    <button
      type="button"
      z-button
      zType="outline"
      (click)="clearFilters()"
      [zTooltip]="'Clear all filters'"
      class="flex items-center gap-2"
    >
      <z-icon zType="circle-x" class="w-4 h-4" />
      Clear
    </button>
  </div>

  <!-- Results Summary -->
  <div class="mb-4" *ngIf="!loading() && memos().length > 0">
    <p class="text-sm text-muted-foreground">
      Showing {{ (currentPage() - 1) * limit + 1 }} -
      {{ Math.min(currentPage() * limit, totalItems()) }} of {{ totalItems() }} memos
    </p>
  </div>

  <!-- Error Message -->
  <z-card *ngIf="error()" class="mb-6 border-destructive">
    <div class="flex items-center gap-2 text-destructive">
      <z-icon zType="triangle-alert" class="w-5 h-5" />
      <span>{{ error() }}</span>
    </div>
  </z-card>

  <!-- Loading Spinner -->
  <z-card *ngIf="loading()" class="mb-6">
    <div class="flex flex-col items-center justify-center py-16">
      <z-icon zType="loader-circle" class="w-12 h-12 text-primary animate-spin" />
      <p class="text-muted-foreground mt-4">Loading memos...</p>
    </div>
  </z-card>

  <!-- Memos Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" *ngIf="!loading() && memos().length > 0">
    <z-card
      *ngFor="let memo of memos()"
      [class.opacity-70]="isExpired(memo)"
      [class.border-l-4]="isExpired(memo)"
      [class.border-l-destructive]="isExpired(memo)"
      class="flex flex-col h-full hover:shadow-lg transition-all duration-300"
    >
      <!-- Memo Header -->
      <div class="flex justify-between items-start mb-4 flex-wrap gap-2">
        <div class="flex flex-wrap gap-2">
          <z-badge [zType]="getPriorityBadgeType(memo.priority)">
            <z-icon zType="flag" class="w-3 h-3 mr-1" />
            {{ memo.priority }}
          </z-badge>
          <z-badge [zType]="getStatusBadgeType(memo.status)">
            {{ memo.status }}
          </z-badge>
          <z-badge zType="default" *ngIf="memo.requires_acknowledgment">
            <z-icon zType="check-square" class="w-3 h-3 mr-1" />
            Requires Ack
          </z-badge>
          <z-badge zType="destructive" *ngIf="isExpired(memo)">
            <z-icon zType="clock" class="w-3 h-3 mr-1" />
            Expired
          </z-badge>
        </div>
        <span class="text-sm text-muted-foreground flex items-center gap-1" *ngIf="memo.published_at">
          <z-icon zType="calendar" class="w-4 h-4" />
          {{ memo.published_at | date:'MMM dd, yyyy' }}
        </span>
      </div>

      <!-- Memo Title -->
      <h3 class="text-xl font-semibold text-foreground mb-3 line-clamp-2">{{ memo.title }}</h3>

      <!-- Memo Summary -->
      <p class="text-muted-foreground text-sm mb-4 flex-grow line-clamp-3" *ngIf="memo.summary">
        {{ memo.summary }}
      </p>

      <!-- Memo Meta -->
      <div class="flex flex-wrap gap-4 py-3 border-t border-b border-border mb-4 text-sm text-muted-foreground">
        <div class="flex items-center gap-1" *ngIf="memo.author">
          <z-icon zType="user" class="w-4 h-4" />
          <span>{{ memo.author.full_name }}</span>
        </div>
        <div class="flex items-center gap-1" *ngIf="memo.target_audience">
          <z-icon zType="users" class="w-4 h-4" />
          <span>{{ memo.target_audience }}</span>
        </div>
        <div class="flex items-center gap-1" *ngIf="memo.view_count > 0">
          <z-icon zType="eye" class="w-4 h-4" />
          <span>{{ memo.view_count }} views</span>
        </div>
        <div class="flex items-center gap-1" *ngIf="memo.requires_acknowledgment">
          <z-icon zType="circle-check" class="w-4 h-4" />
          <span>{{ memo.acknowledgment_count }} acknowledged</span>
        </div>
      </div>

      <!-- Memo Footer -->
      <div class="flex gap-2 mt-auto">
        <a
          [routerLink]="['/communication/memos', memo.id]"
          z-button
          zType="outline"
          zSize="sm"
          class="flex-1 flex items-center justify-center gap-2"
        >
          <z-icon zType="eye" class="w-4 h-4" />
          View Details
        </a>
        <a
          [routerLink]="['/communication/memos', memo.id, 'edit']"
          z-button
          zType="outline"
          zSize="sm"
          class="flex-1 flex items-center justify-center gap-2"
        >
          <z-icon zType="pencil" class="w-4 h-4" />
          Edit
        </a>
      </div>
    </z-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && memos().length === 0 && !error()" class="flex flex-col items-center justify-center py-16 px-4 text-center">
    <z-icon zType="inbox" class="w-16 h-16 text-muted-foreground/50 mb-4" />
    <h3 class="text-lg font-semibold text-foreground mb-2">No Memos Found</h3>
    <p class="text-muted-foreground mb-6" *ngIf="selectedStatus() || selectedPriority() || searchQuery()">
      Try adjusting your filters or search query
    </p>
    <p class="text-muted-foreground mb-6" *ngIf="!selectedStatus() && !selectedPriority() && !searchQuery()">
      No memos have been created yet
    </p>
    <a
      routerLink="/communication/memos/new"
      z-button
      zType="default"
      class="flex items-center gap-2"
    >
      <z-icon zType="plus-circle" class="w-4 h-4" />
      Create First Memo
    </a>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading() && memos().length > 0 && totalPages() > 1" class="mt-8 pt-6 border-t border-border">
    <nav class="flex justify-center" aria-label="Memo pagination">
      <div class="flex items-center gap-2">
        <!-- Previous Button -->
        <button
          z-button
          zType="outline"
          zSize="sm"
          (click)="previousPage()"
          [disabled]="currentPage() === 1"
          class="flex items-center gap-1"
        >
          <z-icon zType="chevron-left" class="w-4 h-4" />
          Previous
        </button>

        <!-- Page Numbers -->
        <button
          *ngFor="let page of [].constructor(totalPages()); let i = index"
          z-button
          [zType]="currentPage() === i + 1 ? 'default' : 'outline'"
          zSize="sm"
          (click)="goToPage(i + 1)"
          [class.hidden]="totalPages() > 7 && (i + 1 < currentPage() - 2 || i + 1 > currentPage() + 2) && i !== 0 && i !== totalPages() - 1"
        >
          {{ i + 1 }}
        </button>

        <!-- Next Button -->
        <button
          z-button
          zType="outline"
          zSize="sm"
          (click)="nextPage()"
          [disabled]="currentPage() === totalPages()"
          class="flex items-center gap-1"
        >
          Next
          <z-icon zType="chevron-right" class="w-4 h-4" />
        </button>
      </div>
    </nav>

    <div class="text-center mt-4">
      <small class="text-sm text-muted-foreground">
        Page {{ currentPage() }} of {{ totalPages() }}
      </small>
    </div>
  </div>
</div>
