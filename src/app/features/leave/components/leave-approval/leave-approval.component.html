<div class="p-6 bg-background min-h-screen">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold text-foreground">Leave Approvals</h1>
      <p class="text-muted-foreground">Review and manage pending leave applications</p>
    </div>
    <button z-button zType="outline" routerLink="/dashboard/leave" class="gap-2">
      <z-icon zType="arrow-left" class="w-4 h-4" />
      Back to List
    </button>
  </div>

  <!-- Filters -->
  <div class="flex flex-wrap items-end gap-3 mb-6">
    <!-- Search -->
    <div class="flex-1 min-w-[250px]">
      <input
        z-input
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="Search by name, ID, or leave type..."
        class="w-full">
    </div>

    <!-- Leave Type Filter -->
    <div class="min-w-[200px]">
      <z-select
        zPlaceholder="All Leave Types"
        [(ngModel)]="selectedLeaveType">
        <z-select-item [zValue]="null">All Leave Types</z-select-item>
        <!-- Leave types will be populated from API -->
      </z-select>
    </div>

    <!-- Department Filter -->
    <div class="min-w-[200px]">
      <z-select
        zPlaceholder="All Departments"
        [(ngModel)]="selectedDepartment">
        <z-select-item [zValue]="''">All Departments</z-select-item>
        <!-- Departments will be populated from API -->
      </z-select>
    </div>

    <!-- Clear Filters -->
    @if (searchTerm() || selectedLeaveType() || selectedDepartment()) {
      <div>
        <button
          z-button
          zType="outline"
          (click)="clearFilters()"
          class="gap-2">
          <z-icon zType="x" class="w-4 h-4" />
          Clear Filters
        </button>
      </div>
    }
  </div>

  <!-- Error Message -->
  @if (error()) {
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2 text-red-800 mb-6">
      <z-icon zType="triangle-alert" class="w-5 h-5" />
      <span>{{ error() }}</span>
    </div>
  }

  <!-- Loading Spinner -->
  @if (loading()) {
    <div class="flex items-center justify-center py-20">
      <z-icon zType="loader-circle" class="w-8 h-8 animate-spin text-primary" />
    </div>
  }

  <!-- Pending Leaves Grid -->
  @if (!loading()) {
    @if (filteredLeaves().length > 0) {
      <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4">
        @for (leave of filteredLeaves(); track leave.id) {
          <z-card class="approval-card hover:shadow-md transition-shadow overflow-hidden py-0">
            <div z-card-content class="p-0 px-0 flex flex-col flex-1">
              <!-- Employee Info -->
              <div class="flex items-start gap-3 p-5 pb-0">
                <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                  <z-icon zType="user" class="w-6 h-6 text-primary" />
                </div>
                <div class="min-w-0 flex-1">
                  <h4 class="text-base font-semibold text-foreground truncate">{{ leave.employee?.full_name }}</h4>
                  <p class="text-sm text-muted-foreground">{{ leave.employee?.position }}</p>
                </div>
              </div>

              <!-- Leave Details -->
              <div class="space-y-3 p-5 flex-1">
                <!-- Leave Type & Duration -->
                <div class="text-sm text-muted-foreground">
                  {{ leave.leave_type?.name }} â€¢ {{ getDaysCount(leave) }}
                </div>

                <!-- Dates -->
                <div class="flex items-center gap-2 text-sm text-muted-foreground">
                  <z-icon zType="calendar" class="w-4 h-4" />
                  <span>{{ formatDate(leave.start_date) }} - {{ formatDate(leave.end_date) }}</span>
                </div>

                <!-- Reason -->
                <p class="text-sm text-foreground line-clamp-2">{{ leave.reason }}</p>
              </div>

              <!-- Action Buttons -->
              <div class="flex items-center justify-between p-5 border-t border-border mt-auto">
                <!-- View Details Button -->
                <button
                  type="button"
                  z-button
                  zType="outline"
                  zSize="sm"
                  (click)="viewLeaveDetails(leave)"
                  class="gap-1">
                  <z-icon zType="eye" class="w-3 h-3" />
                </button>

                <!-- Reject & Approve Group -->
                <div class="flex items-center gap-2">
                  <!-- Reject Button -->
                  <button
                    z-button
                    zType="outline"
                    zSize="sm"
                    [disabled]="processingLeaveId() === leave.id"
                    (click)="openRejectModal(leave.id)"
                    class="gap-1 border-red-500 text-red-600 hover:bg-red-50">
                    <z-icon zType="x" class="w-3 h-3" />
                  </button>

                  <!-- Approve Button -->
                  <button
                    z-button
                    zSize="sm"
                    [disabled]="processingLeaveId() === leave.id"
                    (click)="approveLeave(leave.id)"
                    class="gap-1 bg-green-600 hover:bg-green-700 text-white">
                    @if (processingLeaveId() === leave.id) {
                      <z-icon zType="loader-circle" class="w-3 h-3 animate-spin" />
                    } @else {
                      <z-icon zType="check" class="w-3 h-3" />
                    }
                    Approve
                  </button>
                </div>
              </div>
            </div>
          </z-card>
        }
      </div>
    } @else {
      <!-- Empty State -->
      <div class="flex flex-col items-center justify-center py-20 text-center">
        <z-icon zType="inbox" class="w-16 h-16 text-muted-foreground mb-4" />
        <h3 class="text-lg font-semibold mb-2">No Pending Approvals</h3>
        <p class="text-muted-foreground">There are no pending leave applications to review at this time.</p>
      </div>
    }
  }
</div>

<!-- Reject Modal -->
@if (rejectingLeaveId()) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-background rounded-lg shadow-xl max-w-md w-full">
      <!-- Modal Header -->
      <div class="p-6 border-b border-border">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-foreground">Reject Leave Application</h3>
          <button
            type="button"
            (click)="closeRejectModal()"
            class="text-muted-foreground hover:text-foreground">
            <z-icon zType="x" class="w-5 h-5" />
          </button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="p-6">
        <label class="block text-sm font-medium text-foreground mb-2">
          Reason for Rejection <span class="text-red-500">*</span>
        </label>
        <textarea
          z-input
          [(ngModel)]="rejectionReason"
          rows="4"
          class="!h-auto resize-none w-full"
          placeholder="Please provide a reason for rejecting this leave application..."></textarea>
        <p class="text-xs text-muted-foreground mt-2">
          This reason will be communicated to the employee.
        </p>
      </div>

      <!-- Modal Footer -->
      <div class="p-6 border-t border-border flex items-center justify-end gap-3">
        <button
          z-button
          zType="outline"
          (click)="closeRejectModal()"
          [disabled]="processingLeaveId() !== null">
          Cancel
        </button>
        <button
          z-button
          (click)="rejectLeave()"
          [disabled]="processingLeaveId() !== null || !rejectionReason().trim()"
          class="gap-2 bg-red-600 hover:bg-red-700">
          @if (processingLeaveId() !== null) {
            <z-icon zType="loader-circle" class="w-4 h-4 animate-spin" />
          }
          Reject Leave
        </button>
      </div>
    </div>
  </div>
}
