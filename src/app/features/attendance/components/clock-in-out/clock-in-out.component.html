<div class="bg-background min-h-screen">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold text-foreground">Clock In/Out</h1>
      <p class="text-muted-foreground">Track your daily attendance</p>
    </div>
    <button z-button zType="outline" routerLink="/attendance" class="gap-2">
      <z-icon zType="arrow-left" class="w-4 h-4" />
      Back to List
    </button>
  </div>

  <!-- Success Message -->
  @if (success()) {
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 flex items-center gap-2 text-green-800 mb-6">
      <z-icon zType="circle-check" class="w-5 h-5" />
      <span>{{ success() }}</span>
    </div>
  }

  <!-- Error Message -->
  @if (error()) {
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2 text-red-800 mb-6">
      <z-icon zType="triangle-alert" class="w-5 h-5" />
      <span>{{ error() }}</span>
    </div>
  }

  <!-- Current Time Display Card -->
  <div z-card class="mb-6">
    <div z-card-content class="p-8 text-center">
      <div class="text-5xl font-bold text-foreground mb-2">
        {{ formatCurrentTime() }}
      </div>
      <div class="text-lg text-muted-foreground">
        {{ formatCurrentDate() }}
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Clock In/Out Card -->
    <div z-card>
      <div z-card-content class="p-6">
        <h3 class="text-xl font-semibold text-foreground mb-4 flex items-center gap-2">
          <z-icon zType="clock" class="w-5 h-5" />
          Attendance
        </h3>

        <!-- Attendance Type Selector -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-foreground mb-2">Attendance Type</label>
          <div class="flex gap-2">
            <button
              z-button
              [zType]="attendanceType() === 'Office' ? 'default' : 'outline'"
              class="flex-1 gap-2"
              (click)="attendanceType.set('Office')"
              [disabled]="isClockedIn()">
              <z-icon zType="circle" class="w-4 h-4" />
              Office
            </button>
            <button
              z-button
              [zType]="attendanceType() === 'WFH' ? 'default' : 'outline'"
              class="flex-1 gap-2"
              (click)="attendanceType.set('WFH')"
              [disabled]="isClockedIn()">
              <z-icon zType="house" class="w-4 h-4" />
              Work From Home
            </button>
          </div>
        </div>

        <!-- Location Permission Warning -->
        @if (attendanceType() === 'Office' && locationPermission() === 'denied') {
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-center gap-2 text-yellow-800 mb-4">
            <z-icon zType="circle" class="w-5 h-5" />
            <span class="text-sm">Location permission is required for Office attendance. Please enable it in your browser settings.</span>
          </div>
        }

        <!-- Clock In Button -->
        @if (!isClockedIn()) {
          <button
            z-button
            zType="default"
            zSize="lg"
            class="w-full gap-2 bg-green-600 hover:bg-green-700"
            (click)="clockIn()"
            [disabled]="loading() || loadingLocation()">
            @if (loading() || loadingLocation()) {
              <z-icon zType="loader-circle" class="w-4 h-4 animate-spin" />
            } @else {
              <z-icon zType="clock" class="w-4 h-4" />
            }
            {{ loadingLocation() ? 'Getting Location...' : 'Clock In' }}
          </button>
        }

        <!-- Clock Out Button -->
        @if (isClockedIn()) {
          <button
            z-button
            zType="default"
            zSize="lg"
            class="w-full gap-2 bg-red-600 hover:bg-red-700"
            (click)="clockOut()"
            [disabled]="loading() || loadingLocation()">
            @if (loading() || loadingLocation()) {
              <z-icon zType="loader-circle" class="w-4 h-4 animate-spin" />
            } @else {
              <z-icon zType="clock" class="w-4 h-4" />
            }
            {{ loadingLocation() ? 'Getting Location...' : 'Clock Out' }}
          </button>
        }

        <!-- Clock In/Out Times -->
        <div class="mt-6 space-y-3">
          <div class="flex items-center justify-between py-2 border-b">
            <span class="text-sm text-muted-foreground">Clock In:</span>
            <span class="text-sm font-medium" [class.text-green-600]="clockInTime()">
              {{ formatTime(clockInTime()) }}
            </span>
          </div>
          <div class="flex items-center justify-between py-2 border-b">
            <span class="text-sm text-muted-foreground">Clock Out:</span>
            <span class="text-sm font-medium" [class.text-red-600]="clockOutTime()">
              {{ formatTime(clockOutTime()) }}
            </span>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-muted-foreground">Total Hours:</span>
            <span class="text-sm font-medium" [class.text-blue-600]="totalHours() > 0">
              {{ totalHours() > 0 ? formatHours(totalHours()) : '--' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Status Card -->
    <div z-card>
      <div z-card-content class="p-6">
        <h3 class="text-xl font-semibold text-foreground mb-4 flex items-center gap-2">
          <z-icon zType="circle" class="w-5 h-5" />
          Today's Status
        </h3>

        <div class="flex justify-center mb-6">
          <z-badge
            [zType]="todayAttendance() && todayAttendance()!.is_late && todayAttendance()!.is_early_leave ? 'destructive' : todayAttendance() && todayAttendance()!.is_late ? 'secondary' : todayAttendance() && todayAttendance()!.is_early_leave ? 'outline' : 'default'"
            zShape="pill"
            class="text-sm px-4 py-2">
            {{ getStatusText() }}
          </z-badge>
        </div>

        <!-- Attendance Details -->
        @if (todayAttendance()) {
          <div class="space-y-3">
            <div class="flex items-start gap-3 p-3 bg-muted/30 rounded-lg">
              <z-icon zType="calendar" class="w-4 h-4 mt-0.5 text-muted-foreground" />
              <div class="flex-1">
                <span class="text-sm text-muted-foreground">Type</span>
                <p class="text-sm font-medium text-foreground">{{ todayAttendance()!.type }}</p>
              </div>
            </div>

            @if (todayAttendance()!.is_late) {
              <div class="flex items-start gap-3 p-3 bg-yellow-50 rounded-lg">
                <z-icon zType="triangle-alert" class="w-4 h-4 mt-0.5 text-yellow-600" />
                <div class="flex-1">
                  <span class="text-sm text-yellow-600">Late by</span>
                  <p class="text-sm font-medium text-yellow-800">{{ todayAttendance()!.late_minutes || 0 }} minutes</p>
                </div>
              </div>
            }

            @if (todayAttendance()!.is_early_leave) {
              <div class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg">
                <z-icon zType="circle" class="w-4 h-4 mt-0.5 text-blue-600" />
                <div class="flex-1">
                  <span class="text-sm text-blue-600">Early leave by</span>
                  <p class="text-sm font-medium text-blue-800">{{ todayAttendance()!.early_leave_minutes || 0 }} minutes</p>
                </div>
              </div>
            }

            @if (todayAttendance()!.clock_in_location_address) {
              <div class="flex items-start gap-3 p-3 bg-muted/30 rounded-lg">
                <z-icon zType="circle" class="w-4 h-4 mt-0.5 text-muted-foreground" />
                <div class="flex-1">
                  <span class="text-sm text-muted-foreground">Location</span>
                  <p class="text-sm font-medium text-foreground">{{ todayAttendance()!.clock_in_location_address }}</p>
                </div>
              </div>
            }
          </div>
        }

        <!-- No Attendance Message -->
        @if (!todayAttendance()) {
          <div class="flex flex-col items-center justify-center py-8 text-center">
            <z-icon zType="calendar" class="w-12 h-12 text-muted-foreground mb-3" />
            <p class="text-muted-foreground">You haven't clocked in today</p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Instructions -->
  <div z-card>
    <div z-card-content class="p-6">
      <h4 class="text-lg font-semibold text-foreground mb-4 flex items-center gap-2">
        <z-icon zType="circle" class="w-5 h-5" />
        Instructions
      </h4>
      <ul class="space-y-3">
        <li class="flex items-start gap-3">
          <z-icon zType="circle-check" class="w-4 h-4 mt-0.5 text-green-600" />
          <span class="text-sm text-foreground">Select your attendance type (Office or WFH) before clocking in</span>
        </li>
        <li class="flex items-start gap-3">
          <z-icon zType="circle-check" class="w-4 h-4 mt-0.5 text-green-600" />
          <span class="text-sm text-foreground">For Office attendance, location permission is required</span>
        </li>
        <li class="flex items-start gap-3">
          <z-icon zType="circle-check" class="w-4 h-4 mt-0.5 text-green-600" />
          <span class="text-sm text-foreground">Make sure to clock out at the end of your workday</span>
        </li>
        <li class="flex items-start gap-3">
          <z-icon zType="circle-check" class="w-4 h-4 mt-0.5 text-green-600" />
          <span class="text-sm text-foreground">Contact HR if you need to make manual adjustments</span>
        </li>
      </ul>
    </div>
  </div>
</div>
